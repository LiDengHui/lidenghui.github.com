<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>webpack插件 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="知识点 一个简单的插件构成 webpack构建流程 Tapable是如何把各个插件串联到一起的 compiler以及compileation对象的使用以及它们对应的事件钩子  插件的基本构成plugins 是可以用自身原型方法apply来实例化的对象, apply只在安装插件被webpack compiler执行一次. apply方法传入一个webpack compiler 的应用,来访问编译器回">
<meta property="og:type" content="article">
<meta property="og:title" content="webpack插件">
<meta property="og:url" content="http://example.com/2020/09/20/%E5%89%8D%E7%AB%AF/webpack/webpack%E6%8F%92%E4%BB%B6/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="知识点 一个简单的插件构成 webpack构建流程 Tapable是如何把各个插件串联到一起的 compiler以及compileation对象的使用以及它们对应的事件钩子  插件的基本构成plugins 是可以用自身原型方法apply来实例化的对象, apply只在安装插件被webpack compiler执行一次. apply方法传入一个webpack compiler 的应用,来访问编译器回">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-09-20T06:34:29.000Z">
<meta property="article:modified_time" content="2021-03-10T15:06:33.637Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="webpack">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-前端/webpack/webpack插件" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/09/20/%E5%89%8D%E7%AB%AF/webpack/webpack%E6%8F%92%E4%BB%B6/" class="article-date">
  <time class="dt-published" datetime="2020-09-20T06:34:29.000Z" itemprop="datePublished">2020-09-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/">技术文档</a>►<a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/">前端</a>►<a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/webpack/">webpack</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      webpack插件
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h1><ol>
<li>一个简单的插件构成</li>
<li>webpack构建流程</li>
<li>Tapable是如何把各个插件串联到一起的</li>
<li>compiler以及compileation对象的使用以及它们对应的事件钩子</li>
</ol>
<h1 id="插件的基本构成"><a href="#插件的基本构成" class="headerlink" title="插件的基本构成"></a>插件的基本构成</h1><p><code>plugins</code> 是可以用自身原型方法apply来实例化的对象, apply只在安装插件被webpack compiler执行一次. apply方法传入一个webpack compiler 的应用,来访问编译器回调</p>
<p>一个简单的插件结构:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPlugin</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 在构造函数中获取用户给该插件传入的配置</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">options</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// webpack 会调用 HelloPlugin函数,用来特定时机处理额外的逻辑</span></span><br><span class="line">  <span class="function"><span class="title">apply</span>(<span class="params">compiler</span>)</span> &#123;</span><br><span class="line">    compiler.hooks.emit.tap(<span class="string">&#x27;HelloPlugin&#x27;</span>, <span class="function">(<span class="params">compilation</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="comment">// 在功能流程完成后可以调用webpack提供的回调</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果事件是异步的,会带两个参数, 第二个参数为回调函数,在插件处理完任务时需要调用回调函数通知webpack处理完毕,才能进入下一个流程</span></span><br><span class="line">    compiler.plugin(<span class="string">&#x27;emit&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">compilation, callback</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 支持处理逻辑</span></span><br><span class="line">      <span class="comment">// 处理完毕后执行callback以通知webpack</span></span><br><span class="line">      <span class="comment">// 如果不执行callback, 运行流程将会一直卡在这里不往下执行</span></span><br><span class="line">      callback()</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>插件安装时, 只需要将它的一个实例放到webpack.config.js的plugins数组里面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> HelloPlugin = <span class="built_in">require</span>(<span class="string">&#x27;./hello-plugin.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> webpackConfig = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HelloPlugin(&#123;</span><br><span class="line">      options:<span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="webpack-Plugin的工作原理"><a href="#webpack-Plugin的工作原理" class="headerlink" title="webpack Plugin的工作原理"></a>webpack Plugin的工作原理</h2><ol>
<li>读取配置过程中,开会先执行 new HelloPlugin(options)初始化一个HelloPlugin 获取其实例</li>
<li>初始化 compiler 对象后调用 HelloPlugin.apply(compiler)给插件实例传入compiler对象</li>
<li>插件实例在获取到compiler对象后,就可以通过compiler.plugin(事件名,回调函数)监听到webpack广播出来的事件,并且可以通过compiler对象去操作webpack</li>
</ol>
<h2 id="webpack-构建流程"><a href="#webpack-构建流程" class="headerlink" title="webpack 构建流程"></a>webpack 构建流程</h2><p>webpack的基本构建流程如下:</p>
<ol>
<li>校验配置文件: 读取命令传入或webpack.config.js文件,初始化本次构建配置参数</li>
<li>生成Compiler对象: 执行配置文件中的价差实例化语句 new MyWebpackPlugin(),为webpack事件流挂上自定义hooks</li>
<li>引入entryOption阶段: webpack开始读取配置的Entires,递归遍历所有的入口文件</li>
<li>run/watch: 如果运行在watch模式则执行watch方法,否则执行run方法</li>
<li>compileation: 创建Compilation对象回调compilation相关钩子,依次进入每一个入口文件(entry),使用loader对文件进行编译.通过compilation 我可以读取到module的resource(资源路径)、loaders(使用loader)等信息.在将编译好的文件内容使用acorn 解析成AST静态语法数.然后递归、重复的执行这个过程,所有模块和依赖分析完成后,执行compilation的seal放大对每个chunk进行整理、优化、封装__webpack_require__来模拟模块化操作</li>
<li>emit: 所有文件的编译及转化都已经完成,包含了最终输出的资源,我梦可以在传入事件回调的compilation.asstes上拿到所需要的数据,其中包括即将输出的资源、代码块Chunk等信息</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//修改或添加资源</span></span><br><span class="line">compilation.assets[<span class="string">`new-file.js`</span>] = &#123;</span><br><span class="line">  <span class="function"><span class="title">source</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`var a= 1;`</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">size</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.source().length;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>afterEmit: 文件已经写入磁盘完成</li>
<li>done: 完成编译</li>
</ol>
<h1 id="webpack流程图"><a href="#webpack流程图" class="headerlink" title="webpack流程图"></a>webpack流程图</h1><p>webpack编译</p>
<ol>
<li>webpack 配置处理 <ol>
<li>错误检查、增加默认配置等</li>
</ol>
</li>
<li>编译前的准备工作<ol>
<li>处理webpack配置中的plugin、webpack自己一堆的plugin、初始化compiler等等</li>
</ol>
</li>
<li>开始编译主入口</li>
<li>resolve阶段: 解析文件路径&amp;loaders<ol>
<li>将文件的绝对路径解析出;同时解析出inline和我们配置在webpack.config.js中匹配的loaders,将loaders解析为固定的格式以及loaders执行文件的路径</li>
</ol>
</li>
<li>loaders逐个执行</li>
<li>parse阶段 <ol>
<li>将文件转换为ast树,解析出import和export等</li>
</ol>
</li>
<li>递归处理依赖</li>
<li>module一些优化&amp;增加id</li>
<li>生成chunk,决定每个chunk中包含的module</li>
<li>生成文件<ol>
<li> 耕具模板生成文件名称;生成文件,这里会再次用到前面parse阶段的内容,将<code>import xxx``export xxx</code> 替换成webpack的写法</li>
</ol>
</li>
<li>写文件,结束</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://blog.didiyun.com/index.php/2019/03/01/webpack/">webpack插件机制</a></p>
<h1 id="理解事件流机制tapable"><a href="#理解事件流机制tapable" class="headerlink" title="理解事件流机制tapable"></a>理解事件流机制tapable</h1><p>webpkac本质上是一种事件流机制, 他的工作流程就是将各个插件串联起来,而实现这一切的核心就是Tapable</p>
<p>webpack的tapable事件流机制保证了插件的有序性, 将各个插件串联起来,webpack 在运行过程中会广播事件, 插件知识需要监听它所关心的事件,就能加入到这条webpack机制中去,去去改变webpack的运作,使得整个系统的扩展性良好</p>
<p>tapable 也是一个小型的library, 是webpakc的核心工具. 类似于node中的events库,核心原理就是一个订阅发布模式,作用是提供类似的插件接口</p>
<p>webpack中最核心的负责编译的Compiler和负责构建bundles的Compilation都是Tapable的实例,可以直接在Compiler和Compilation对象上广播和监听事件,方法如下:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 广播事件</span></span><br><span class="line"><span class="comment"> * event-name 为事件名称,注意不要和现有的事件名重复</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"></span><br><span class="line">compiler.apply(<span class="string">&#x27;event-name&#x27;</span>, params)</span><br><span class="line">compilation.apply(<span class="string">&#x27;event-name&#x27;</span>, params)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">compiler.plugin(<span class="string">&quot;event-name&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">params</span>) </span>&#123;&#125;)</span><br><span class="line">compilation.plugin(<span class="string">&quot;event-name&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">params</span>)</span>&#123;&#125;),</span><br></pre></td></tr></table></figure>

<p>Tabable 类暴露了 tap、tapAsync、和tapPromise 方法,可以根据钩子的同步/异步方式来选择一个函数注入逻辑</p>
<p>tap同步钩子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compiler.hooks.compile.tap(<span class="string">&quot;MyPlugin&quot;</span>, <span class="function"><span class="params">params</span> =&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;以同步方式出发compile钩子&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>tapAsync 异步钩子, 通过 callback回调告诉webpack异步执行完毕tapPromise 异步钩子,返回一个Promise告诉webpack异步执行完毕</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">compiler.hooks.run.tapAsync(<span class="string">&quot;MyPlugin&quot;</span>,<span class="function">(<span class="params">compiler,callback</span>) =&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;异步方式触及 run 钩子。&quot;</span>);</span><br><span class="line">  callback();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">compiler.hooks.run.tapPromise(<span class="string">&quot;MyPlugin&quot;</span>, <span class="function"><span class="params">compiler</span> =&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span> setTImeojut(resolve,<span class="number">1000</span>)).then=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;以具有延迟的异步方式触及 run 钩子&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>

<h2 id="Tapable-用法"><a href="#Tapable-用法" class="headerlink" title="Tapable 用法"></a>Tapable 用法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; </span><br><span class="line">  SyncHook, <span class="comment">// 同步钩子</span></span><br><span class="line">  SyncBailHook, <span class="comment">// 同步保险钩子</span></span><br><span class="line">  SyncWaterfallHook, <span class="comment">// 同步瀑布沟组 </span></span><br><span class="line">  SyncLoopHook,  <span class="comment">// 同步循环钩子</span></span><br><span class="line">  AsyncParallelHook, <span class="comment">// 异步</span></span><br><span class="line">  AsyncParallelBailHook, <span class="comment">// 异步并醒保险钩子</span></span><br><span class="line">  AsyncSeriesHook, <span class="comment">// 异步串行钩子</span></span><br><span class="line">  AsyncSeriesBailHook, <span class="comment">// 异步串行保险钩子</span></span><br><span class="line">  AsyncSeriesWaterfallHook <span class="comment">// 异步串行瀑布钩子</span></span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&quot;tapable&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="简单实现一个SyncHook"><a href="#简单实现一个SyncHook" class="headerlink" title="简单实现一个SyncHook"></a>简单实现一个SyncHook</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hook</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">args</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.taps = [];</span><br><span class="line">    <span class="built_in">this</span>.interceptors = [];</span><br><span class="line">    <span class="built_in">this</span>._args = args;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">tap</span>(<span class="params">name, fn</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.taps.push(&#123;name, fn&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SyncHook</span> <span class="keyword">extends</span> <span class="title">Hook</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">call</span>(<span class="params">name, fn</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123; </span><br><span class="line">      <span class="built_in">this</span>.taps.forEach(<span class="function"><span class="params">tap</span> =&gt;</span>tap.fn(name))</span><br><span class="line">      fn(<span class="literal">null</span>, name)</span><br><span class="line">    &#125; <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">      fn(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="关联-Tapable-和-webpack-插件"><a href="#关联-Tapable-和-webpack-插件" class="headerlink" title="关联 Tapable 和 webpack 插件"></a>关联 Tapable 和 webpack 插件</h2><p>Compiler.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;AsyncSeriesHook, SyncHook&#125; = reuqire(<span class="string">&quot;tapable&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compiler</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.hooks = &#123;</span><br><span class="line">      run : <span class="keyword">new</span> AsyncSeriesHook([<span class="string">&quot;compiler“]), // 异步钩子</span></span><br><span class="line"><span class="string">      compile: new SyncHook([&quot;</span>params<span class="string">&quot;]) // 同步钩子</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  run() &#123;</span></span><br><span class="line"><span class="string">    // 执行异步钩子</span></span><br><span class="line"><span class="string">    this.hooks.run.callAsync(this, err =&gt; &#123;</span></span><br><span class="line"><span class="string">      this.comile(onCompiled)</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  compile() &#123;</span></span><br><span class="line"><span class="string">    // 执行同步钩子, 并传参</span></span><br><span class="line"><span class="string">    this.hooks.compile.call(params);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">module.exports = Compiler</span></span><br></pre></td></tr></table></figure>

<p>MyPlugin.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> Compiler = <span class="built_in">require</span>(<span class="string">&quot;./Compiler&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPlugin</span>  </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">apply</span>(<span class="params">compiler</span>)</span> &#123; <span class="comment">// 接收compiler参数</span></span><br><span class="line">    compiler.hooks.run.tap(<span class="string">&quot;MyPlugin&quot;</span>, <span class="function">()=&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;开始编译....&quot;</span>))</span><br><span class="line">    compiler.hooks.compiler.tapAsync(<span class="string">&quot;MyPlugin&quot;</span>,<span class="function">(<span class="params">name,age</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;编译中&quot;</span>)</span><br><span class="line">      &#125;,<span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里类似webpack.config.js的plugin配置</span></span><br><span class="line"><span class="comment">// 向 plugins属性传入new 实例</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myPlugin = <span class="keyword">new</span> MyPlugin();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  plugins: [myPlugin]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> compiler = <span class="keyword">new</span> Compiler(options)</span><br><span class="line">compiler.run();</span><br></pre></td></tr></table></figure>

<h2 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/tugenhua0707/p/11317557.html">tapable 源码解析</a></p>
<h1 id="理解Compiler-负责编译"><a href="#理解Compiler-负责编译" class="headerlink" title="理解Compiler(负责编译)"></a>理解Compiler(负责编译)</h1><p>Compiler 对象包含了当前运行webpack的配置,包括entry、 output、loaders等配置,这个对象在启动webpack时被实例化, 而且全局唯一的,plugin可以通过对象获取到webpack配置星系进行处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Compiler 结构</span></span><br><span class="line">Compiler &#123;</span><br><span class="line">  _pluginCompat: SyncBailHook &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line">  hooks: &#123;</span><br><span class="line">    shouldEmit: SyncBailHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    done: AsyncSeriesHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    additionalPass: AsyncSeriesHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    beforeRun: AsyncSeriesHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    run: AsyncSeriesHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    emit: AsyncSeriesHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    assetEmitted: AsyncSeriesHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    afterEmit: AsyncSeriesHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    thisCompilation: SyncHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    compilation: SyncHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    normalModuleFactory: SyncHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    contextModuleFactory: SyncHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    beforeCompile: AsyncSeriesHook &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;,</span><br><span class="line">    compile: SyncHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    make: AsyncParallelHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    afterCompile: AsyncSeriesHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    watchRun: AsyncSeriesHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    failed: SyncHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    invalid: SyncHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    watchClose: SyncHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    infrastructureLog: SyncBailHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    environment: SyncHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    afterEnvironment: SyncHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    afterPlugins: SyncHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    afterResolvers: SyncHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    entryOption: SyncBailHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;,</span><br><span class="line">    infrastructurelog: SyncBailHook &#123;</span><br><span class="line">     ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">  outputPath: <span class="string">&#x27;&#x27;</span>,<span class="comment">//输出目录</span></span><br><span class="line">  outputFileSystem: NodeOutputFileSystem &#123;</span><br><span class="line">   ...</span><br><span class="line">  &#125;,</span><br><span class="line">  inputFileSystem: CachedInputFileSystem &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">  options: &#123;</span><br><span class="line">    <span class="comment">//Compiler对象包含了webpack的所有配置信息，entry、module、output、resolve等信息</span></span><br><span class="line">    entry: [</span><br><span class="line">      <span class="string">&#x27;babel-polyfill&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;/Users/frank/Desktop/fe/fe-blog/webpack-plugin/src/index.js&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    devServer: &#123; <span class="attr">port</span>: <span class="number">3000</span> &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [ MyWebpackPlugin &#123;&#125; ],</span><br><span class="line">    mode: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    context: <span class="string">&#x27;/Users/frank/Desktop/fe/fe-blog/webpack-plugin&#x27;</span>,</span><br><span class="line">    devtool: <span class="literal">false</span>,</span><br><span class="line">    ...</span><br><span class="line">    performance: &#123;</span><br><span class="line">      maxAssetSize: <span class="number">250000</span>,</span><br><span class="line">      maxEntrypointSize: <span class="number">250000</span>,</span><br><span class="line">      hints: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    optimization: &#123;</span><br><span class="line">      ... </span><br><span class="line">    &#125;,</span><br><span class="line">    resolve: &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;,</span><br><span class="line">    resolveLoader: &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;,</span><br><span class="line">    infrastructureLogging: &#123; <span class="attr">level</span>: <span class="string">&#x27;info&#x27;</span>, <span class="attr">debug</span>: <span class="literal">false</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  context: <span class="string">&#x27;/Users/frank/Desktop/fe/fe-blog/webpack-plugin&#x27;</span>,<span class="comment">//上下文，文件目录</span></span><br><span class="line">  requestShortener: RequestShortener &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">  watchFileSystem: NodeWatchFileSystem &#123;</span><br><span class="line">    <span class="comment">//监听文件变化列表信息</span></span><br><span class="line">     ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Compiler-源码精简版代码解析"><a href="#Compiler-源码精简版代码解析" class="headerlink" title="Compiler 源码精简版代码解析"></a>Compiler 源码精简版代码解析</h2><p><code>https://github.com/webpack/webpack/blob/master/lib/Compiler.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; SyncHook, SyncBailHook, AsyncSeriesHook &#125; = <span class="built_in">require</span>(<span class="string">&quot;tapable&quot;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compiler</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 定义生命周期钩子</span></span><br><span class="line">    <span class="built_in">this</span>.hooks = <span class="built_in">Object</span>.freeze(&#123;</span><br><span class="line">      <span class="comment">// ...只列举几个常用的常见钩子，更多hook就不列举了，有兴趣看源码</span></span><br><span class="line">      done: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">&quot;stats&quot;</span>]),<span class="comment">//一次编译完成后执行，回调参数：stats</span></span><br><span class="line">      beforeRun: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">&quot;compiler&quot;</span>]),</span><br><span class="line">      run: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">&quot;compiler&quot;</span>]),<span class="comment">//在编译器开始读取记录前执行</span></span><br><span class="line">      emit: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">&quot;compilation&quot;</span>]),<span class="comment">//在生成文件到output目录之前执行，回调参数： compilation</span></span><br><span class="line">      afterEmit: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">&quot;compilation&quot;</span>]),<span class="comment">//在生成文件到output目录之后执行</span></span><br><span class="line">      compilation: <span class="keyword">new</span> SyncHook([<span class="string">&quot;compilation&quot;</span>, <span class="string">&quot;params&quot;</span>]),<span class="comment">//在一次compilation创建后执行插件</span></span><br><span class="line">      beforeCompile: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">&quot;params&quot;</span>]),</span><br><span class="line">      compile: <span class="keyword">new</span> SyncHook([<span class="string">&quot;params&quot;</span>]),<span class="comment">//在一个新的compilation创建之前执行</span></span><br><span class="line">      make:<span class="keyword">new</span> AsyncParallelHook([<span class="string">&quot;compilation&quot;</span>]),<span class="comment">//完成一次编译之前执行</span></span><br><span class="line">      afterCompile: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">&quot;compilation&quot;</span>]),</span><br><span class="line">      watchRun: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">&quot;compiler&quot;</span>]),</span><br><span class="line">      failed: <span class="keyword">new</span> SyncHook([<span class="string">&quot;error&quot;</span>]),</span><br><span class="line">      watchClose: <span class="keyword">new</span> SyncHook([]),</span><br><span class="line">      afterPlugins: <span class="keyword">new</span> SyncHook([<span class="string">&quot;compiler&quot;</span>]),</span><br><span class="line">      entryOption: <span class="keyword">new</span> SyncBailHook([<span class="string">&quot;context&quot;</span>, <span class="string">&quot;entry&quot;</span>])</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// ...省略代码</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">newCompilation</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 创建Compilation对象回调compilation相关钩子</span></span><br><span class="line">    <span class="keyword">const</span> compilation = <span class="keyword">new</span> Compilation(<span class="built_in">this</span>);</span><br><span class="line">    <span class="comment">//...一系列操作</span></span><br><span class="line">    <span class="built_in">this</span>.hooks.compilation.call(compilation, params); <span class="comment">//compilation对象创建完成 </span></span><br><span class="line">    <span class="keyword">return</span> compilation</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">watch</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//如果运行在watch模式则执行watch方法，否则执行run方法</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.running) &#123;</span><br><span class="line">      <span class="keyword">return</span> handler(<span class="keyword">new</span> ConcurrentCompilationError());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.running = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">this</span>.watchMode = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Watching(<span class="built_in">this</span>, watchOptions, handler);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">run</span>(<span class="params">callback</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.running) &#123;</span><br><span class="line">      <span class="keyword">return</span> callback(<span class="keyword">new</span> ConcurrentCompilationError());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.running = <span class="literal">true</span>;</span><br><span class="line">    process.nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.emitAssets(compilation, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="comment">// 在编译和输出的流程中遇到异常时，会触发 failed 事件 </span></span><br><span class="line">          <span class="built_in">this</span>.hooks.failed.call(err)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">if</span> (compilation.hooks.needAdditionalPass.call()) &#123;</span><br><span class="line">          <span class="comment">// ...</span></span><br><span class="line">          <span class="comment">// done：完成编译</span></span><br><span class="line">          <span class="built_in">this</span>.hooks.done.callAsync(stats, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 创建compilation对象之前   </span></span><br><span class="line">            <span class="built_in">this</span>.compile(onCompiled);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.emitRecords(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.hooks.done.callAsync(stats, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.hooks.beforeRun.callAsync(<span class="built_in">this</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.hooks.run.callAsync(<span class="built_in">this</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.readRecords(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.compile(onCompiled);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">compile</span>(<span class="params">callback</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> params = <span class="built_in">this</span>.newCompilationParams();</span><br><span class="line">    <span class="built_in">this</span>.hooks.beforeCompile.callAsync(params, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.hooks.compile.call(params);</span><br><span class="line">      <span class="keyword">const</span> compilation = <span class="built_in">this</span>.newCompilation(params);</span><br><span class="line">      <span class="comment">//触发make事件并调用addEntry，找到入口js，进行下一步</span></span><br><span class="line">      <span class="built_in">this</span>.hooks.make.callAsync(compilation, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        process.nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          compilation.finish(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 封装构建结果（seal），逐次对每个module和chunk进行整理，每个chunk对应一个入口文件</span></span><br><span class="line">            compilation.seal(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="built_in">this</span>.hooks.afterCompile.callAsync(compilation, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 异步的事件需要在插件处理完任务时调用回调函数通知 Webpack 进入下一个流程，</span></span><br><span class="line">                <span class="comment">// 不然运行流程将会一直卡在这不往下执行</span></span><br><span class="line">                <span class="keyword">return</span> callback(<span class="literal">null</span>, compilation);</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">emitAssets</span>(<span class="params">compilation, callback</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> emitFiles = <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//...省略一系列代码</span></span><br><span class="line">      <span class="comment">// afterEmit：文件已经写入磁盘完成</span></span><br><span class="line">      <span class="built_in">this</span>.hooks.afterEmit.callAsync(compilation, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line">        <span class="keyword">return</span> callback();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// emit 事件发生时，可以读取到最终输出的资源、代码块、模块及其依赖，并进行修改(这是最后一次修改最终文件的机会)</span></span><br><span class="line">    <span class="built_in">this</span>.hooks.emit.callAsync(compilation, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line">      outputPath = compilation.getPath(<span class="built_in">this</span>.outputPath, &#123;&#125;);</span><br><span class="line">      mkdirp(<span class="built_in">this</span>.outputFileSystem, outputPath, emitFiles);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...省略代码</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>apply 方法中插入钩子的一般形式如下;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// compiler提供了compiler.hooks,可以根据这些不同的时刻去让插件做不同的事情</span></span><br><span class="line">compiler.hooks.阶段.tap函数(<span class="string">&quot;插件名称&quot;</span>, <span class="function">(<span class="params">阶段回调参数</span>)=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">compiler.run(callback)</span><br></pre></td></tr></table></figure>

<h1 id="理解Compilation-负责创建Bundles"><a href="#理解Compilation-负责创建Bundles" class="headerlink" title="理解Compilation (负责创建Bundles)"></a>理解Compilation (负责创建Bundles)</h1><p>Compilation对象代表了一次资源版本构建.当运行webpack开发环境中间件时,每当检测到一个文件的变化,就会创建一个新的compilation,从而生成一组新的编译资源,一个Compilation对象表现了当前的模块资源、编译生成资源、编译文件、以及被跟踪依赖的状态信息, 简单来讲就是把本次打包编译的内容存到内存里,Compilation对象也提供了插件需要自定义功能的回调,以插件做自定义处理时选择使用拓展.</p>
<p>简单来说,Compilation的职责就是构建模块和Chunk, 并利用插件优化构建过程.</p>
<p>和Compiler用法相同,钩子类型不同名,也可以在某些钩子上访问tapAsync和taoPromsie</p>
<p>参考:<br><a target="_blank" rel="noopener" href="https://github.com/webpack/webpack/blob/master/lib/Compilation.js"></a></p>
<h2 id="常见的Compilation-Hooks区别"><a href="#常见的Compilation-Hooks区别" class="headerlink" title="常见的Compilation Hooks区别"></a>常见的Compilation Hooks区别</h2><table>
<thead>
<tr>
<th>钩子</th>
<th>类型</th>
<th>什么时候调用</th>
</tr>
</thead>
<tbody><tr>
<td>buildModule</td>
<td>SyncHook</td>
<td>在模块开始编译前触发名可以用于修改模块</td>
</tr>
<tr>
<td>successModule</td>
<td>SyncHook</td>
<td>在一个模块被修改成功编译,会执行这个钩子</td>
</tr>
<tr>
<td>finishMoudles</td>
<td>AsyncSeriesHook</td>
<td>当所有模块都编译成功后调用</td>
</tr>
<tr>
<td>seal</td>
<td>SyncHook</td>
<td>当一次compilation停止接收新模块时触发</td>
</tr>
<tr>
<td>optimizeDependencies</td>
<td>SyncBailHook</td>
<td>当依赖优化开始执行</td>
</tr>
<tr>
<td>optimize</td>
<td>SyncHook</td>
<td>在优化阶段开始执行</td>
</tr>
<tr>
<td>optimizeMoudules</td>
<td>SyncBailHook</td>
<td>在模块优化阶段开始时执行, 插件可以在这个钩子颗粒执行的模块的优化,回调参数modules</td>
</tr>
<tr>
<td>optimizeChunks</td>
<td>SyncBailHook</td>
<td>在代码块优化阶段开始执行, 插件可以在这个钩子里执行对代码快的优化,回调参数chunks</td>
</tr>
<tr>
<td>optimizeChunkAssets</td>
<td>AsyncSeriesHook</td>
<td>优化任何代码快资源,在这些资源存放在compilation.assets上,一个chunk有一个files属性,他指向有一个chunk创建的所有文件,任何额外的chunk资源都存放在compilation.additionalChunkAssets上.回调参数: chunks</td>
</tr>
<tr>
<td>optimizeAssets</td>
<td>AsyncSeriesHook</td>
<td>优化说有存放在compilation.assets的所有资源,回调参数assets</td>
</tr>
</tbody></table>
<h1 id="Compiler-和-Compilation-的区别"><a href="#Compiler-和-Compilation-的区别" class="headerlink" title="Compiler 和 Compilation 的区别"></a>Compiler 和 Compilation 的区别</h1><p>Compilaer 代表了整个webpack从启动到关闭的生命周期,而Compilation只代表了一次新的编译,只要文件有改动,compilation就会被重新创建</p>
<h1 id="常用-API"><a href="#常用-API" class="headerlink" title="常用 API"></a>常用 API</h1><p>插件可以用来修改输出文件、增加输出文件、甚至可以提升webpack性能、总之插件可以通过调用webpack提供的API能完成很多事情,由于webpack提供的API非常多,</p>
<h2 id="读取输出资源、代码块、模块以及依赖"><a href="#读取输出资源、代码块、模块以及依赖" class="headerlink" title="读取输出资源、代码块、模块以及依赖"></a>读取输出资源、代码块、模块以及依赖</h2><p>有些插件可能需要读取webpack的处理结果,例如输出资源、代码块、模块及其依赖,以便做下一步处理、在emit事件发生时, 代表源文件的转换和组装已经完成,在这里可以读取到最终将输出的资源、代码块、模块及其依赖,并且可以修改输出资源的内容.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Plugin</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">apply</span>(<span class="params">compiler</span>)</span> &#123;</span><br><span class="line">    compiler.plugin(<span class="string">&#x27;emit&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">compilation, callback</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// compilation.chunks 存放所有代码块，是一个数组</span></span><br><span class="line">      compilation.chunks.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// chunk 代表一个代码块</span></span><br><span class="line">        <span class="comment">// 代码块由多个模块组成，通过 chunk.forEachModule 能读取组成代码块的每个模块</span></span><br><span class="line">        chunk.forEachModule(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">module</span></span>) </span>&#123;</span><br><span class="line">          <span class="comment">// module 代表一个模块</span></span><br><span class="line">          <span class="comment">// module.fileDependencies 存放当前模块的所有依赖的文件路径，是一个数组</span></span><br><span class="line">          <span class="built_in">module</span>.fileDependencies.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">filepath</span>) </span>&#123;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Webpack 会根据 Chunk 去生成输出的文件资源，每个 Chunk 都对应一个及其以上的输出文件</span></span><br><span class="line">        <span class="comment">// 例如在 Chunk 中包含了 CSS 模块并且使用了 ExtractTextPlugin 时，</span></span><br><span class="line">        <span class="comment">// 该 Chunk 就会生成 .js 和 .css 两个文件</span></span><br><span class="line">        chunk.files.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">filename</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// compilation.assets 存放当前所有即将输出的资源</span></span><br><span class="line">          <span class="comment">// 调用一个输出资源的 source() 方法能获取到输出资源的内容</span></span><br><span class="line">          <span class="keyword">let</span> source = compilation.assets[filename].source();</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 这是一个异步事件，要记得调用 callback 通知 Webpack 本次事件监听处理结束。</span></span><br><span class="line">      <span class="comment">// 如果忘记了调用 callback，Webpack 将一直卡在这里而不会往后执行。</span></span><br><span class="line">      callback();</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="监听文件变化"><a href="#监听文件变化" class="headerlink" title="监听文件变化"></a>监听文件变化</h2><p>webpack会从配置入口模块触发, 依次找出所有依赖模块,当入口模块或则其依赖的模块发生变化时, 就会触发一次新的Compilation</p>
<p>在开发插件时经常需要知道哪个文件发生变化导致了新的Compilation,为此可以使用如下代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当依赖的文件发生变化时会触发 watch-run 事件</span></span><br><span class="line">compiler.hooks.watchRun.tap(<span class="string">&#x27;MyPlugin&#x27;</span>, <span class="function">(<span class="params">watching, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 获取发生变化的文件列表</span></span><br><span class="line">  <span class="keyword">const</span> changedFiles = watching.compiler.watchFileSystem.watcher.mtimes;</span><br><span class="line">  <span class="comment">// changedFiles 格式为键值对，键为发生变化的文件路径。</span></span><br><span class="line">  <span class="keyword">if</span> (changedFiles[filePath] !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="comment">// filePath 对应的文件发生了变化</span></span><br><span class="line">  &#125;</span><br><span class="line">  callback();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>默认情况下webpack只会监控入口文件及其依赖的模块是否发生变化,在有些情况下项目可能需要引入新文件, 例如引入一个HTML文件.由于javascript文件不会去导入HTML文件,webpack就不会监听HTML文件的变化,编辑HTML文件就不会重新触发新的Compilation.为了监听HTML文件的变化,我们需要把HTML文件加入到依赖列表中,</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">compiler.hooks.afterCompile.tap(<span class="string">&#x27;MyPlugin&#x27;</span>, <span class="function">(<span class="params">compilation, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 把 HTML 文件添加到文件依赖列表，好让 Webpack 去监听 HTML 模块文件，在 HTML 模版文件发生变化时重新启动一次编译</span></span><br><span class="line">  compilation.fileDependencies.push(filePath);</span><br><span class="line">  callback();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="修改输出资源"><a href="#修改输出资源" class="headerlink" title="修改输出资源"></a>修改输出资源</h2><p>在有些场景下插件需要修改、增加、删除输出的资源, 要做到这点需要监听emit事件,因为发出emit事件时所有模块的转换和代码对应的文件已经生成好了,需要输出的资源即将输出,因此emit事件是修改webpack输出资源的最后的时机</p>
<p>所有的需要输出的资源都会存放在compilation.assets中, compilation.assets是一个键值对,键为需要输出的文件名称,值为文件对应的内容<br>设置Comilation.assets的代码如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置名称为 fileName 的输出资源</span></span><br><span class="line">  compilation.assets[fileName] = &#123;</span><br><span class="line">    <span class="comment">// 返回文件内容</span></span><br><span class="line">    source: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// fileContent 既可以是代表文本文件的字符串，也可以是代表二进制文件的 Buffer</span></span><br><span class="line">      <span class="keyword">return</span> fileContent;</span><br><span class="line">      &#125;,</span><br><span class="line">    <span class="comment">// 返回文件大小</span></span><br><span class="line">      size: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> Buffer.byteLength(fileContent, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  callback();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="判断webpack使用了哪些插件"><a href="#判断webpack使用了哪些插件" class="headerlink" title="判断webpack使用了哪些插件"></a>判断webpack使用了哪些插件</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断当前配置使用使用了 ExtractTextPlugin，</span></span><br><span class="line"><span class="comment">// compiler 参数即为 Webpack 在 apply(compiler) 中传入的参数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hasExtractTextPlugin</span>(<span class="params">compiler</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 当前配置所有使用的插件列表</span></span><br><span class="line">  <span class="keyword">const</span> plugins = compiler.options.plugins;</span><br><span class="line">  <span class="comment">// 去 plugins 中寻找有没有 ExtractTextPlugin 的实例</span></span><br><span class="line">  <span class="keyword">return</span> plugins.find(<span class="function"><span class="params">plugin</span>=&gt;</span>plugin.__proto__.constructor === ExtractTextPlugin) != <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考:<br><a target="_blank" rel="noopener" href="http://wushaobin.top/2019/03/15/webpackPlugin/">webpack学习-pluign</a></p>
<h2 id="管理Warnings和-Errors"><a href="#管理Warnings和-Errors" class="headerlink" title="管理Warnings和 Errors"></a>管理Warnings和 Errors</h2><p>如果在apply函数内插入throw new Error(“Message”), 终端会打印出Unhandle rejection Error:Message. 然后webpack中断执行.为了不影响compilation.warnings和compilation.errors</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compilation.warnings.push(<span class="string">&quot;warning&quot;</span>);</span><br><span class="line">compilation.errors.push(<span class="string">&quot;error&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="参考-2"><a href="#参考-2" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://juejin.im/post/6844904161515929614">https://juejin.im/post/6844904161515929614</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/20/%E5%89%8D%E7%AB%AF/webpack/webpack%E6%8F%92%E4%BB%B6/" data-id="ckm3ks2m7009vnzx40f8f7laz" data-title="webpack插件" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/09/21/%E5%89%8D%E7%AB%AF/webpack/loader%E4%B8%8Eplugin/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          loader与plugin的区别
        
      </div>
    </a>
  
  
    <a href="/2020/09/20/%E5%89%8D%E7%AB%AF/webpack/gulp/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">gulp</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/">技术文档</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/">前端</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/CSS/">CSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/HTTP/">HTTP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/HTTPS/">HTTPS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/JS/">JS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/Koa/">Koa</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/Promise/">Promise</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/Vue/">Vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/async/">async</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/async/await/">await</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/ci/">ci</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/ci-cd/">ci/cd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/css/">css</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/db/">db</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/e2e/">e2e</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/mac/">mac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/node/">node</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/test/">test</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/vue/">vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/vue3/">vue3</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/webpack/">webpack</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/">函数式编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/%E5%9B%BE%E7%89%87/">图片</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/%E6%B5%8B%E8%AF%95/">测试</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/%E6%B5%8F%E8%A7%88%E5%99%A8/">浏览器</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%B7%A5%E5%85%B7/">工具</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%B7%A5%E5%85%B7/PPT/">PPT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%B7%A5%E5%85%B7/iterm2/">iterm2</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%B7%A5%E5%85%B7/markdown/">markdown</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ssh/">ssh</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E7%AE%97%E6%B3%95/">算法</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8F%E8%A7%88%E5%99%A8/">浏览器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">计算机基础</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTPS/" rel="tag">HTTPS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS/" rel="tag">JS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Koa/" rel="tag">Koa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PPT/" rel="tag">PPT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Promise/" rel="tag">Promise</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angularjs/" rel="tag">angularjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/async/" rel="tag">async</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/await/" rel="tag">await</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ci/" rel="tag">ci</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ci-cd/" rel="tag">ci/cd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/db/" rel="tag">db</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/e2e/" rel="tag">e2e</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/error/" rel="tag">error</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gogs/" rel="tag">gogs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iterm2/" rel="tag">iterm2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jest/" rel="tag">jest</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/" rel="tag">mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/" rel="tag">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/" rel="tag">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/" rel="tag">test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue3/" rel="tag">vue3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" rel="tag">函数式编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%BE%E7%89%87/" rel="tag">图片</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag">基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A1%86%E6%9E%B6/" rel="tag">框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag">测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" rel="tag">浏览器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%84%E4%BB%B6/" rel="tag">组件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag">网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" rel="tag">计算机基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%AD%E8%A8%80/" rel="tag">语言</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/HTTP/" style="font-size: 11.43px;">HTTP</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/JS/" style="font-size: 15.71px;">JS</a> <a href="/tags/Javascript/" style="font-size: 10px;">Javascript</a> <a href="/tags/Koa/" style="font-size: 10px;">Koa</a> <a href="/tags/PHP/" style="font-size: 10px;">PHP</a> <a href="/tags/PPT/" style="font-size: 10px;">PPT</a> <a href="/tags/Promise/" style="font-size: 11.43px;">Promise</a> <a href="/tags/Vue/" style="font-size: 10px;">Vue</a> <a href="/tags/angularjs/" style="font-size: 12.86px;">angularjs</a> <a href="/tags/async/" style="font-size: 10px;">async</a> <a href="/tags/await/" style="font-size: 10px;">await</a> <a href="/tags/ci/" style="font-size: 10px;">ci</a> <a href="/tags/ci-cd/" style="font-size: 10px;">ci/cd</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/db/" style="font-size: 10px;">db</a> <a href="/tags/docker/" style="font-size: 11.43px;">docker</a> <a href="/tags/e2e/" style="font-size: 10px;">e2e</a> <a href="/tags/error/" style="font-size: 10px;">error</a> <a href="/tags/gogs/" style="font-size: 10px;">gogs</a> <a href="/tags/iterm2/" style="font-size: 10px;">iterm2</a> <a href="/tags/javascript/" style="font-size: 14.29px;">javascript</a> <a href="/tags/jest/" style="font-size: 10px;">jest</a> <a href="/tags/js/" style="font-size: 18.57px;">js</a> <a href="/tags/mac/" style="font-size: 11.43px;">mac</a> <a href="/tags/markdown/" style="font-size: 11.43px;">markdown</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/test/" style="font-size: 10px;">test</a> <a href="/tags/vscode/" style="font-size: 12.86px;">vscode</a> <a href="/tags/vue/" style="font-size: 14.29px;">vue</a> <a href="/tags/vue3/" style="font-size: 10px;">vue3</a> <a href="/tags/webpack/" style="font-size: 17.14px;">webpack</a> <a href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">函数式编程</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 20px;">前端</a> <a href="/tags/%E5%9B%BE%E7%89%87/" style="font-size: 10px;">图片</a> <a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 10px;">基础</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 10px;">开发</a> <a href="/tags/%E6%A1%86%E6%9E%B6/" style="font-size: 12.86px;">框架</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 11.43px;">测试</a> <a href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" style="font-size: 14.29px;">浏览器</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 12.86px;">算法</a> <a href="/tags/%E7%BB%84%E4%BB%B6/" style="font-size: 10px;">组件</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 11.43px;">网络</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" style="font-size: 11.43px;">计算机基础</a> <a href="/tags/%E8%AF%AD%E8%A8%80/" style="font-size: 14.29px;">语言</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/11/ci/ssh/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/03/11/ci/nginx/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/03/11/ci/circleci/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/03/11/%E7%AE%97%E6%B3%95/LRU%E9%A1%B5%E9%9D%A2%E7%BD%AE%E6%8D%A2%E7%AE%97%E6%B3%95/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/03/11/%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%BF%98%E8%AE%B0%E5%AF%86%E7%A0%81%E6%81%A2%E5%A4%8D/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>