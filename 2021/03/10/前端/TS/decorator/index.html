<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="装饰器(decorator)装饰器是一种特殊的声明, 可以附加在类、方法、访问器、属性、参数声明上 装饰器使用@expression的形式,其中expression必须能够演算为运行时调用的函数,其中包含装饰声明信息. 装饰器类型及其执行顺序为  类装饰器—优先级 4 (对象实例化, 静态) 方法装饰器—优先级 2 (对象实例化, 静态) 访问器或属性装饰器—优先级 3 (对象实例化, 静态) 参">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2021/03/10/%E5%89%8D%E7%AB%AF/TS/decorator/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="装饰器(decorator)装饰器是一种特殊的声明, 可以附加在类、方法、访问器、属性、参数声明上 装饰器使用@expression的形式,其中expression必须能够演算为运行时调用的函数,其中包含装饰声明信息. 装饰器类型及其执行顺序为  类装饰器—优先级 4 (对象实例化, 静态) 方法装饰器—优先级 2 (对象实例化, 静态) 访问器或属性装饰器—优先级 3 (对象实例化, 静态) 参">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-03-10T15:06:32.713Z">
<meta property="article:modified_time" content="2021-03-10T15:06:32.713Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-前端/TS/decorator" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/10/%E5%89%8D%E7%AB%AF/TS/decorator/" class="article-date">
  <time class="dt-published" datetime="2021-03-10T15:06:32.713Z" itemprop="datePublished">2021-03-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="装饰器-decorator"><a href="#装饰器-decorator" class="headerlink" title="装饰器(decorator)"></a>装饰器(decorator)</h1><p>装饰器是一种特殊的声明, 可以附加在类、方法、访问器、属性、参数声明上</p>
<p>装饰器使用<code>@expression</code>的形式,其中expression必须能够演算为运行时调用的函数,其中包含装饰声明信息.</p>
<p>装饰器类型及其执行顺序为</p>
<ol>
<li>类装饰器—优先级 4 (对象实例化, 静态)</li>
<li>方法装饰器—优先级 2 (对象实例化, 静态)</li>
<li>访问器或属性装饰器—优先级 3 (对象实例化, 静态)</li>
<li>参数装饰器—优先级1 (对象实例化, 静态)</li>
</ol>
<p>注意,如果装饰器应用与类构造函数的参数,那么不同的装饰器的优先级为:</p>
<ol>
<li>参数装饰器</li>
<li>方法装饰器</li>
<li>访问器或参数装饰器</li>
<li>构造器参数装饰器</li>
<li>类装饰器</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是一个装饰器工厂——有助于将用户参数传给装饰器声明</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;f(): evaluated&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">target, propertyKey: <span class="built_in">string</span>, descriptor: PropertyDescriptor</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;f(): called&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">g</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;g(): evaluated&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">target, propertyKey: <span class="built_in">string</span>, descriptor: PropertyDescriptor</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;g(): called&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">  <span class="meta">@f</span>()</span><br><span class="line">  <span class="meta">@g</span>()</span><br><span class="line">  <span class="function"><span class="title">method</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// f(): evaluated</span></span><br><span class="line"><span class="comment">// g(): evaluated</span></span><br><span class="line"><span class="comment">// g(): called</span></span><br><span class="line"><span class="comment">// f(): called</span></span><br></pre></td></tr></table></figure>

<p><code>f</code>和<code>g</code>返回了另一个函数(装饰器函数). <code>f</code>和<code>g</code>称为装饰器工厂</p>
<blockquote>
<p><code>装饰器工厂</code>帮助用户传递可供装饰器利用的参数</p>
</blockquote>
<p>我们可以看到装饰器的,<code>演算规则</code>为<strong>由顶向上</strong>,执行顺序<strong>由底向上</strong></p>
<h2 id="装饰器的签名"><a href="#装饰器的签名" class="headerlink" title="装饰器的签名"></a>装饰器的签名</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> TypedPropertyDescriptor&lt;T&gt; &#123;</span><br><span class="line">    enumerable?: <span class="built_in">boolean</span>;</span><br><span class="line">    configurable?: <span class="built_in">boolean</span>;</span><br><span class="line">    writable?: <span class="built_in">boolean</span>;</span><br><span class="line">    value?: T;</span><br><span class="line">    get?: <span class="function">() =&gt;</span> T;</span><br><span class="line">    set?: <span class="function">(<span class="params">value: T</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">type</span> ClassDecorator = <span class="xml"><span class="tag">&lt;<span class="name">TFunction</span> <span class="attr">extends</span> <span class="attr">Function</span>&gt;</span>(target: TFunction) =&gt; TFunction | void;</span></span><br><span class="line"><span class="xml">declare type PropertyDecorator = (target: Object, propertyKey: string | symbol) =&gt; void;</span></span><br><span class="line">declare type MethodDecorator = &lt;T&gt;(target: Object, propertyKey: string | symbol, descriptor: TypedPropertyDescriptor&lt;T&gt;) =&gt; TypedPropertyDescriptor&lt;T&gt; | void;</span><br><span class="line">declare type ParameterDecorator = (target: Object, propertyKey: string | symbol, parameterIndex: number) =&gt; void;</span><br></pre></td></tr></table></figure>

<h2 id="方法装饰器"><a href="#方法装饰器" class="headerlink" title="方法装饰器"></a>方法装饰器</h2><p>可以从上面的签名中,看到它有三个参数</p>
<ol>
<li>target: 当前对象的原型,也就是说,假设Employee是对象,那么target就是Employee.prototype</li>
<li>propertyKey: 方法的名称</li>
<li>descriptor: 方法的属性描述符,即Object.getOwnPropertyDescriptor(Employ.prototype, propertyKey)</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">logMethod</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  target: <span class="built_in">Object</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  propertyName: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  propertyDescriptor: PropertyDescriptor</span>): <span class="title">PropertyDescriptor</span> </span>&#123;</span><br><span class="line">  <span class="comment">// target === Employee.prototype</span></span><br><span class="line">  <span class="comment">// propertyName === &quot;greet&quot;</span></span><br><span class="line">  <span class="comment">// propertyDesciptor === Object.getOwnPropertyDescriptor(Employee.prototype, &quot;greet&quot;)</span></span><br><span class="line">  <span class="keyword">const</span> method = propertyDesciptor.value;</span><br><span class="line"></span><br><span class="line">  propertyDesciptor.value = <span class="function"><span class="keyword">function</span> (<span class="params">...args: <span class="built_in">any</span>[]</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 将 greet 的参数列表转换为字符串</span></span><br><span class="line">    <span class="keyword">const</span> params = args.map(<span class="function"><span class="params">a</span> =&gt;</span> <span class="built_in">JSON</span>.stringify(a)).join();</span><br><span class="line">    <span class="comment">// 调用 greet() 并获取其返回值</span></span><br><span class="line">    <span class="keyword">const</span> result = method.apply(<span class="built_in">this</span>, args);</span><br><span class="line">    <span class="comment">// 转换结尾为字符串</span></span><br><span class="line">    <span class="keyword">const</span> r = <span class="built_in">JSON</span>.stringify(result);</span><br><span class="line">    <span class="comment">// 在终端显示函数调用细节</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Call: <span class="subst">$&#123;propertyName&#125;</span>(<span class="subst">$&#123;params&#125;</span>) =&gt; <span class="subst">$&#123;r&#125;</span>`</span>);</span><br><span class="line">    <span class="comment">// 返回调用函数的结果</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> propertyDesciptor;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> firstName: <span class="built_in">string</span>, <span class="keyword">private</span> lastName: <span class="built_in">string</span></span></span><br><span class="line"><span class="params">    </span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@logMethod</span></span><br><span class="line">    greet(message: <span class="built_in">string</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.firstName&#125;</span> <span class="subst">$&#123;<span class="built_in">this</span>.lastName&#125;</span> says: <span class="subst">$&#123;message&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emp = <span class="keyword">new</span> Employee(<span class="string">&#x27;Mohan Ram&#x27;</span>, <span class="string">&#x27;Ratnakumar&#x27;</span>);</span><br><span class="line">emp.greet(<span class="string">&#x27;hello&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>javascript 编译后是什么样</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> __decorate =</span><br><span class="line">    (<span class="built_in">this</span> &amp;&amp; <span class="built_in">this</span>.__decorate) ||</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">decorators, target, key, desc</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 函数参数长度</span></span><br><span class="line">        <span class="keyword">var</span> c = <span class="built_in">arguments</span>.length;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 处理结果</span></span><br><span class="line"><span class="comment">         * 如果仅仅传入了装饰器数组和目标，那么应该是个类装饰器。</span></span><br><span class="line"><span class="comment">         * 否则，如果描述符（第 4 个参数）为 null，就根据已知值准备属性描述符，</span></span><br><span class="line"><span class="comment">         * 反之则使用同一描述符。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> r =</span><br><span class="line">            c &lt; <span class="number">3</span></span><br><span class="line">                ? target</span><br><span class="line">                : desc === <span class="literal">null</span></span><br><span class="line">                ? (desc = <span class="built_in">Object</span>.getOwnPropertyDescriptor(target, key))</span><br><span class="line">                : desc;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 声明存储装饰器的变量</span></span><br><span class="line">        <span class="keyword">var</span> d;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果原生反射可用，使用原生反射触发装饰器</span></span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            <span class="keyword">typeof</span> <span class="built_in">Reflect</span> === <span class="string">&quot;object&quot;</span> &amp;&amp;</span><br><span class="line">            <span class="keyword">typeof</span> <span class="built_in">Reflect</span>.decorate === <span class="string">&quot;function&quot;</span></span><br><span class="line">        ) &#123;</span><br><span class="line">            r = <span class="built_in">Reflect</span>.decorate(decorators, target, key, desc);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 自右向左迭代装饰器</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = decorators.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">                <span class="comment">// 如果装饰器合法，将其赋值给 d</span></span><br><span class="line">                <span class="keyword">if</span> ((d = decorators[i])) &#123;</span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * 如果仅仅传入了装饰器数组和目标，那么应该是类装饰器，</span></span><br><span class="line"><span class="comment">                     * 传入目标调用装饰器。</span></span><br><span class="line"><span class="comment">                     * 否则，如果 4 个参数俱全，那么应该是方法装饰器，</span></span><br><span class="line"><span class="comment">                     * 据此进行调用。</span></span><br><span class="line"><span class="comment">                     * 反之则使用同一描述符。</span></span><br><span class="line"><span class="comment">                     * 如果传入了 3 个参数，那么应该是属性装饰器，可进行相应的调用。</span></span><br><span class="line"><span class="comment">                     * 如果以上条件皆不满足，返回处理的结果。</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    r =</span><br><span class="line">                        (c &lt; <span class="number">3</span></span><br><span class="line">                            ? d(r)</span><br><span class="line">                            : c &gt; <span class="number">3</span></span><br><span class="line">                            ? d(target, key, r)</span><br><span class="line">                            : d(target, key)) || r;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 由于只有方法装饰器需要根据应用装饰器的结果修正其属性，</span></span><br><span class="line"><span class="comment">         * 所以最后返回处理好的 r</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> c &gt; <span class="number">3</span> &amp;&amp; r &amp;&amp; <span class="built_in">Object</span>.defineProperty(target, key, r), r;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Employee = <span class="comment">/** <span class="doctag">@class </span>*/</span> (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Employee</span>(<span class="params">firstName, lastName</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.firstName = firstName;</span><br><span class="line">        <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line">    Employee.prototype.greet = <span class="function"><span class="keyword">function</span> (<span class="params">message</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.firstName + <span class="string">&quot; &quot;</span> + <span class="built_in">this</span>.lastName + <span class="string">&quot; says: &quot;</span> + message;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// typescript 调用 `__decorate` 辅助函数，</span></span><br><span class="line">    <span class="comment">// 以便在对象原型上应用装饰器</span></span><br><span class="line">    __decorate([logMethod], Employee.prototype, <span class="string">&quot;greet&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> Employee;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="keyword">var</span> emp = <span class="keyword">new</span> Employee(<span class="string">&quot;Mohan Ram&quot;</span>, <span class="string">&quot;Ratnakumar&quot;</span>);</span><br><span class="line">emp.greet(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>让我们开始分析<code>Employee</code>函数—构造器初始化<code>name</code>和<code>greet</code>方法,将其传入原型.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__decorate([logMethod], Employee.prototype, <span class="string">&quot;greet&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>这是 TypeScript 自动生成的通用方法，它根据装饰器类型和相应参数处理装饰器函数调用。</p>
<p>该函数有助于内省方法调用，并为开发者铺平了处理类似<code>日志</code>、<code>记忆化</code>、<code>应用配置</code>等横切关注点的道路。</p>
<p>在这个例子中，我们仅仅打印了函数调用及其参数、响应。</p>
<p>注意，阅读 <code>__decorate</code> 方法中的详细注释可以理解其内部机制。</p>
<h2 id="属性装饰器"><a href="#属性装饰器" class="headerlink" title="属性装饰器"></a>属性装饰器</h2><p>属性装饰器有两个参数</p>
<ol>
<li>target: 当前对象原型, 也就说,假设Employee是对象,那么target就是Employee.prototype</li>
<li>propertyKey: 属性名称</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logParameter</span>(<span class="params">target: <span class="built_in">Object</span>, propertyName: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 属性值</span></span><br><span class="line">    <span class="keyword">let</span> _val = <span class="built_in">this</span>[propertyName];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 属性读取访问器</span></span><br><span class="line">    <span class="keyword">const</span> getter = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`Get: <span class="subst">$&#123;propertyName&#125;</span> =&gt; <span class="subst">$&#123;_val&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">return</span> _val;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 属性写入访问器</span></span><br><span class="line">    <span class="keyword">const</span> setter = <span class="function"><span class="params">newVal</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`Set: <span class="subst">$&#123;propertyName&#125;</span> =&gt; <span class="subst">$&#123;newVal&#125;</span>`</span>);</span><br><span class="line">        _val = newVal;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除属性</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">delete</span> <span class="built_in">this</span>[propertyName]) &#123;</span><br><span class="line">        <span class="comment">// 创建新属性及其读取访问器、写入访问器</span></span><br><span class="line">        <span class="built_in">Object</span>.defineProperty(target, propertyName, &#123;</span><br><span class="line">            get: getter,</span><br><span class="line">            set: setter,</span><br><span class="line">            enumerable: <span class="literal">true</span>,</span><br><span class="line">            configurable: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    <span class="meta">@logParameter</span></span><br><span class="line">    name: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emp = <span class="keyword">new</span> Employee();</span><br><span class="line">emp.name = <span class="string">&#x27;Mohan Ram&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(emp.name);</span><br><span class="line"><span class="comment">// Set: name =&gt; Mohan Ram</span></span><br><span class="line"><span class="comment">// Get: name =&gt; Mohan Ram</span></span><br><span class="line"><span class="comment">// Mohan Ram</span></span><br></pre></td></tr></table></figure>
<p>上面的代码中, 我们在装饰器中内省属性的可访问性, 下面是编译后的代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Employee = <span class="comment">/** <span class="doctag">@class </span>*/</span> (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Employee</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    __decorate([</span><br><span class="line">        logParameter</span><br><span class="line">    ], Employee.prototype, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> Employee;</span><br><span class="line">&#125;());</span><br><span class="line"><span class="keyword">var</span> emp = <span class="keyword">new</span> Employee();</span><br><span class="line">emp.name = <span class="string">&#x27;Mohan Ram&#x27;</span>; <span class="comment">// Set: name =&gt; Mohan Ram</span></span><br><span class="line"><span class="built_in">console</span>.log(emp.name); <span class="comment">// Get: name =&gt; Mohan Ram</span></span><br></pre></td></tr></table></figure>

<h2 id="参数装饰器"><a href="#参数装饰器" class="headerlink" title="参数装饰器"></a>参数装饰器</h2><p>参数装饰器函数有三个参数: </p>
<ol>
<li>target: 当前对象的原型,也就是说,假设Employee是对象, 那么 target就是Employee.prototype</li>
<li>propertyKey: 参数名称</li>
<li>index: 参数数组中的位置</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logParameter</span>(<span class="params">target: <span class="built_in">Object</span>, propertyName: <span class="built_in">string</span>, index: <span class="built_in">number</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 为相应方法生成元数据键，以储存被装饰的参数的位置</span></span><br><span class="line">    <span class="keyword">const</span> metadataKey = <span class="string">`log_<span class="subst">$&#123;propertyName&#125;</span>_parameters`</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(target[metadataKey])) &#123;</span><br><span class="line">        target[metadataKey].push(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        target[metadataKey] = [index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    greet(<span class="meta">@logParameter</span> message: <span class="built_in">string</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`hello <span class="subst">$&#123;message&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> emp = <span class="keyword">new</span> Employee();</span><br><span class="line">emp.greet(<span class="string">&#x27;hello&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>上面的代码中,我们收集了所有被装饰的方法的索引或位置, 作为元数据加入对象的原型.后面是编译后的代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回接受参数索引和装饰器的函数</span></span><br><span class="line"><span class="keyword">var</span> __param = (<span class="built_in">this</span> &amp;&amp; <span class="built_in">this</span>.__param) || <span class="function"><span class="keyword">function</span> (<span class="params">paramIndex, decorator</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 该函数返回装饰器</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">target, key</span>) </span>&#123; decorator(target, key, paramIndex); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Employee = <span class="comment">/** <span class="doctag">@class </span>*/</span> (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Employee</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    Employee.prototype.greet = <span class="function"><span class="keyword">function</span> (<span class="params">message</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello &quot;</span> + message;</span><br><span class="line">    &#125;;</span><br><span class="line">    __decorate([</span><br><span class="line">        __param(<span class="number">0</span>, logParameter)</span><br><span class="line">    ], Employee.prototype, <span class="string">&quot;greet&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> Employee;</span><br><span class="line">&#125;());</span><br><span class="line"><span class="keyword">var</span> emp = <span class="keyword">new</span> Employee();</span><br><span class="line">emp.greet(<span class="string">&#x27;hello&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>类似之前见过的__decorate函数,__param 函数返回一个封装参数装饰器的装饰器</p>
<p>如我们所见,调用参数装饰器时, 会忽略其返回值.这就意味着,调用<code>__param</code>函数时, 其返回值不会用来覆盖参数值</p>
<p>这就是<code>参数装饰器</code>不反回的原因</p>
<h2 id="访问器装饰器"><a href="#访问器装饰器" class="headerlink" title="访问器装饰器"></a>访问器装饰器</h2><p>访问器不过是类声明中属性的读取访问器和写入访问器</p>
<p>访问器装饰器应用于访问器的<code>属性描述符</code>,可用于<code>观测</code>、<code>修改</code>、<code>替换</code>访问器的定义</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enumerable</span>(<span class="params">value: boolean</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">      target: any, propertyKey: string, descriptor: PropertyDescriptor</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;decorator - sets the enumeration part of the accessor&#x27;</span>);</span><br><span class="line">        descriptor.enumerable = value;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    private _salary: number;</span><br><span class="line">    private _name: string;</span><br><span class="line"></span><br><span class="line">    @enumerable(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">get</span> <span class="title">salary</span>() &#123; <span class="keyword">return</span> <span class="string">`Rs. <span class="subst">$&#123;<span class="built_in">this</span>._salary&#125;</span>`</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span> <span class="title">salary</span>(<span class="params">salary: any</span>) &#123; <span class="built_in">this</span>._salary = +salary; &#125;</span><br><span class="line"></span><br><span class="line">    @enumerable(<span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">get</span> <span class="title">name</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`Sir/Madam, <span class="subst">$&#123;<span class="built_in">this</span>._name&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span> <span class="title">name</span>(<span class="params">name: string</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>._name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emp = <span class="keyword">new</span> Employee();</span><br><span class="line">emp.salary = <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> emp) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`enumerable property = <span class="subst">$&#123;prop&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// salary 属性不在清单上，因为我们将其设为假</span></span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line"><span class="comment">// decorator - sets the enumeration part of the accessor</span></span><br><span class="line"><span class="comment">// decorator - sets the enumeration part of the accessor</span></span><br><span class="line"><span class="comment">// enumerable property = _salary</span></span><br><span class="line"><span class="comment">// enumerable property = name</span></span><br></pre></td></tr></table></figure>

<p>上面的例子中,我们定义了两个访问器<code>name</code>和<code>salary</code>,并通过装饰器设置是否将其列入清单,据此决定对象的行为.<code>name</code>将入清单,而<code>salary</code>不会</p>
<p>下面是编译的代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enumerable</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">target, propertyKey, descriptor</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;decorator - sets the enumeration part of the accessor&#x27;</span>);</span><br><span class="line">        descriptor.enumerable = value;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Employee = <span class="comment">/** <span class="doctag">@class </span>*/</span> (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Employee</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(Employee.prototype, <span class="string">&quot;salary&quot;</span>, &#123;</span><br><span class="line">        get: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="string">&quot;Rs. &quot;</span> + <span class="built_in">this</span>._salary; &#125;,</span><br><span class="line">        set: <span class="function"><span class="keyword">function</span> (<span class="params">salary</span>) </span>&#123; <span class="built_in">this</span>._salary = +salary; &#125;,</span><br><span class="line">        enumerable: <span class="literal">true</span>,</span><br><span class="line">        configurable: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(Employee.prototype, <span class="string">&quot;name&quot;</span>, &#123;</span><br><span class="line">        get: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Sir/Madam, &quot;</span> + <span class="built_in">this</span>._name;</span><br><span class="line">        &#125;,</span><br><span class="line">        set: <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">this</span>._name = name;</span><br><span class="line">        &#125;,</span><br><span class="line">        enumerable: <span class="literal">true</span>,</span><br><span class="line">        configurable: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    __decorate([</span><br><span class="line">        enumerable(<span class="literal">false</span>)</span><br><span class="line">    ], Employee.prototype, <span class="string">&quot;salary&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">    __decorate([</span><br><span class="line">        enumerable(<span class="literal">true</span>)</span><br><span class="line">    ], Employee.prototype, <span class="string">&quot;name&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">return</span> Employee;</span><br><span class="line">&#125;());</span><br><span class="line"><span class="keyword">var</span> emp = <span class="keyword">new</span> Employee();</span><br><span class="line">emp.salary = <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> prop <span class="keyword">in</span> emp) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;enumerable property = &quot;</span> + prop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="类装饰器"><a href="#类装饰器" class="headerlink" title="类装饰器"></a>类装饰器</h2><p>类装饰器应用于类的构造器,可用于观测、修改、替换类的定义</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">logClass</span>(<span class="params">target: <span class="built_in">Function</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 保存一份原构造器的引用</span></span><br><span class="line">    <span class="keyword">const</span> original = target;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成类的实例的辅助函数</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">construct</span>(<span class="params">constructor, args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> c: <span class="built_in">any</span> = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title">constructor</span>.<span class="title">apply</span>(<span class="params"><span class="built_in">this</span>, args</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        c.prototype = <span class="title">constructor</span>.<span class="title">prototype</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> c();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 新构造器行为</span></span><br><span class="line">    <span class="keyword">const</span> f: <span class="built_in">any</span> = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`New: <span class="subst">$&#123;original[<span class="string">&#x27;name&#x27;</span>]&#125;</span> is created`</span>);</span><br><span class="line">        <span class="keyword">return</span> construct(original, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 复制 prototype 属性，保持 intanceof 操作符可用</span></span><br><span class="line">    f.prototype = original.prototype;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回新构造器（将覆盖原构造器）</span></span><br><span class="line">    <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@logClass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> emp = <span class="keyword">new</span> Employee();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;emp instanceof Employee&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(emp <span class="keyword">instanceof</span> Employee); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>上面的装饰器声明了一个名为original的变量,将其值设为装饰的类构造器.</p>
<p>接着声明了一个名为construct的辅助函数,该函数用于创建类的实例.</p>
<p>接下来创建了一个名为f的变量,该变量用于用作新的构造器,该函数调用原构造器,同时在控制台打印了实例话的类名</p>
<p>这正是我们给原构造器加入的额外的行为的地方<br>原来构造器的原型复制到了f,以确保创建一个Employee新实例的时候,instanceof操作符的效果符合预期</p>
<p>新构造器一旦就绪,我们便返回它, 以完成类构造器的实现</p>
<p>新构造器就绪后,每次创建实例时会在控制台打印类名</p>
<p>编译后的代码如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Employee = <span class="comment">/** <span class="doctag">@class </span>*/</span> (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Employee</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    Employee = __decorate([</span><br><span class="line">        logClass</span><br><span class="line">    ], Employee);</span><br><span class="line">    <span class="keyword">return</span> Employee;</span><br><span class="line">&#125;());</span><br><span class="line"><span class="keyword">var</span> emp = <span class="keyword">new</span> Employee();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;emp instanceof Employee&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(emp <span class="keyword">instanceof</span> Employee);</span><br></pre></td></tr></table></figure>

<p>在编译后的代码中,我们注意到两处不同:</p>
<ol>
<li>传给__decorate的参数有两个, 装饰器数组和构造器函数</li>
<li>TypeScript编译器使用__decorate的返回值以覆盖原构造器</li>
</ol>
<p>这正是类装饰器必须返回一个构造函数的原因所在</p>
<h2 id="装饰器工厂"><a href="#装饰器工厂" class="headerlink" title="装饰器工厂"></a>装饰器工厂</h2><p>由于每种装饰器都有它自身的调用签名,我们可以使用装饰器工厂来泛化装饰器调用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; logClass &#125; <span class="keyword">from</span> <span class="string">&#x27;./class-decorator&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; logMethod &#125; <span class="keyword">from</span> <span class="string">&#x27;./method-decorator&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; logProperty &#125; <span class="keyword">from</span> <span class="string">&#x27;./property-decorator&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; logParameter &#125; <span class="keyword">from</span> <span class="string">&#x27;./parameter-decorator&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器工厂，根据传入的参数调用相应的装饰器</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (args.length) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>: <span class="comment">// 可能是方法装饰器或参数装饰器</span></span><br><span class="line">            <span class="comment">// 如果第三个参数是数字，那么它是索引，所以这是参数装饰器</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">typeof</span> args[<span class="number">2</span>] === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> logParameter.apply(<span class="built_in">this</span>, args);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> logMethod.apply(<span class="built_in">this</span>, args);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: <span class="comment">// 属性装饰器 </span></span><br><span class="line">            <span class="keyword">return</span> logProperty.apply(<span class="built_in">this</span>, args);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// 类装饰器</span></span><br><span class="line">            <span class="keyword">return</span> logClass.apply(<span class="built_in">this</span>, args);</span><br><span class="line">        <span class="keyword">default</span>: <span class="comment">// 参数数目不合法</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Not a valid decorator&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@log</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    <span class="meta">@log</span></span><br><span class="line">    <span class="keyword">private</span> name: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@log</span></span><br><span class="line">    greet(<span class="meta">@log</span> message: <span class="built_in">string</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span> says: <span class="subst">$&#123;message&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="元信息反射API"><a href="#元信息反射API" class="headerlink" title="元信息反射API"></a>元信息反射API</h2><p>元信息反射API(例如 Reflect)能够用来以标准的方式组织元信息.</p>
<p>[反射]的意思是代码可以侦测同一系统中的其他代码(或其自身).</p>
<p>反射在组合/依赖注入、运行时类型断言、测试等使用场景下很有用.</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect-metadata&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数装饰器使用反射 api 存储被装饰参数的索引</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">logParameter</span>(<span class="params">target: <span class="built_in">Object</span>, propertyName: <span class="built_in">string</span>, index: <span class="built_in">number</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 获取目标对象的元信息</span></span><br><span class="line">    <span class="keyword">const</span> indices = <span class="built_in">Reflect</span>.getMetadata(<span class="string">`log_<span class="subst">$&#123;propertyName&#125;</span>_parameters`</span>, target, propertyName) || [];</span><br><span class="line">    indices.push(index);</span><br><span class="line">    <span class="comment">// 定义目标对象的元信息</span></span><br><span class="line">    <span class="built_in">Reflect</span>.defineMetadata(<span class="string">`log_<span class="subst">$&#123;propertyName&#125;</span>_parameters`</span>, indices, target, propertyName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性装饰器使用反射 api 获取属性的运行时类型</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">logProperty</span>(<span class="params">target: <span class="built_in">Object</span>, propertyName: <span class="built_in">string</span></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 获取对象属性的设计类型</span></span><br><span class="line">    <span class="keyword">var</span> t = <span class="built_in">Reflect</span>.getMetadata(<span class="string">&quot;design:type&quot;</span>, target, propertyName);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;propertyName&#125;</span> type: <span class="subst">$&#123;t.name&#125;</span>`</span>); <span class="comment">// name type: String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    <span class="meta">@logProperty</span></span><br><span class="line">    <span class="keyword">private</span> name: <span class="built_in">string</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    greet(<span class="meta">@logParameter</span> message: <span class="built_in">string</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span> says: <span class="subst">$&#123;message&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码用到了<code>reflect-metadata</code>这个库.其中我们使用了反射元信息的设计键(例如<code>design:type</code>).目前只有三个:</p>
<ol>
<li>类型元信息: <code>design:type</code>,</li>
<li>参数类型元信息: <code>design:paramtypes</code></li>
<li>返回类型元信息: <code>design:returntype</code>,</li>
</ol>
<p>有了反射.我们就能够在运行时得到一下信息: </p>
<ol>
<li>实体名</li>
<li>实体类型</li>
<li>实体实现的接口</li>
<li>实体构造器参数的名称和类型</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>装饰器 不过是在设计时帮助内省代码,注解及修改类和属性的函数</li>
<li>Yehuda Katz 提议在ECMAScript2016标准中加入装饰器特征<a target="_blank" rel="noopener" href="https://github.com/tc39/proposal-decorators">tc39/proposal-decorators</a></li>
<li>我们可以通过装饰器工厂将用户提供的参数传给装饰器</li>
<li>有4种装饰器: 类装饰器、方法装饰器、属性/访问器装饰器、参数装饰器</li>
<li>元信息反射API有助于以标准化的方式在对象中加入元信息,以及在运行时获取设计类型信息</li>
</ol>
<h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><p>本文源于</p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/6844903876605280269">https://juejin.im/post/6844903876605280269</a></p>
<p>代码<br><a target="_blank" rel="noopener" href="https://github.com/mohanramphp/typescript-decorators">https://github.com/mohanramphp/typescript-decorators</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/10/%E5%89%8D%E7%AB%AF/TS/decorator/" data-id="ckm3ks1ww006enzx44aydf59n" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/03/10/%E5%89%8D%E7%AB%AF/Vue/defineProperties/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2021/03/10/%E5%89%8D%E7%AB%AF/Node/V8%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/V8%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/">技术文档</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/">前端</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/CSS/">CSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/HTTP/">HTTP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/HTTPS/">HTTPS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/JS/">JS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/Koa/">Koa</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/Promise/">Promise</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/Vue/">Vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/async/">async</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/async/await/">await</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/ci/">ci</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/ci-cd/">ci/cd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/css/">css</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/db/">db</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/e2e/">e2e</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/mac/">mac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/node/">node</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/test/">test</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/vue/">vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/vue3/">vue3</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/webpack/">webpack</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/">函数式编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/%E5%9B%BE%E7%89%87/">图片</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/%E6%B5%8B%E8%AF%95/">测试</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF/%E6%B5%8F%E8%A7%88%E5%99%A8/">浏览器</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%B7%A5%E5%85%B7/">工具</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%B7%A5%E5%85%B7/PPT/">PPT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%B7%A5%E5%85%B7/iterm2/">iterm2</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E5%B7%A5%E5%85%B7/markdown/">markdown</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ssh/">ssh</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/%E7%AE%97%E6%B3%95/">算法</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">计算机基础</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTPS/" rel="tag">HTTPS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS/" rel="tag">JS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Koa/" rel="tag">Koa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PPT/" rel="tag">PPT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Promise/" rel="tag">Promise</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angularjs/" rel="tag">angularjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/async/" rel="tag">async</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/await/" rel="tag">await</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ci/" rel="tag">ci</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ci-cd/" rel="tag">ci/cd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/db/" rel="tag">db</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/e2e/" rel="tag">e2e</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/error/" rel="tag">error</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gogs/" rel="tag">gogs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iterm2/" rel="tag">iterm2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jest/" rel="tag">jest</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/" rel="tag">mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/" rel="tag">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/" rel="tag">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/" rel="tag">test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue3/" rel="tag">vue3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" rel="tag">函数式编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%BE%E7%89%87/" rel="tag">图片</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag">基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A1%86%E6%9E%B6/" rel="tag">框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag">测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" rel="tag">浏览器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%84%E4%BB%B6/" rel="tag">组件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag">网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" rel="tag">计算机基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%AD%E8%A8%80/" rel="tag">语言</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/HTTP/" style="font-size: 11.43px;">HTTP</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/JS/" style="font-size: 15.71px;">JS</a> <a href="/tags/Javascript/" style="font-size: 10px;">Javascript</a> <a href="/tags/Koa/" style="font-size: 10px;">Koa</a> <a href="/tags/PHP/" style="font-size: 10px;">PHP</a> <a href="/tags/PPT/" style="font-size: 10px;">PPT</a> <a href="/tags/Promise/" style="font-size: 11.43px;">Promise</a> <a href="/tags/Vue/" style="font-size: 10px;">Vue</a> <a href="/tags/angularjs/" style="font-size: 12.86px;">angularjs</a> <a href="/tags/async/" style="font-size: 10px;">async</a> <a href="/tags/await/" style="font-size: 10px;">await</a> <a href="/tags/ci/" style="font-size: 10px;">ci</a> <a href="/tags/ci-cd/" style="font-size: 10px;">ci/cd</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/db/" style="font-size: 10px;">db</a> <a href="/tags/docker/" style="font-size: 11.43px;">docker</a> <a href="/tags/e2e/" style="font-size: 10px;">e2e</a> <a href="/tags/error/" style="font-size: 10px;">error</a> <a href="/tags/gogs/" style="font-size: 10px;">gogs</a> <a href="/tags/iterm2/" style="font-size: 10px;">iterm2</a> <a href="/tags/javascript/" style="font-size: 14.29px;">javascript</a> <a href="/tags/jest/" style="font-size: 10px;">jest</a> <a href="/tags/js/" style="font-size: 18.57px;">js</a> <a href="/tags/mac/" style="font-size: 11.43px;">mac</a> <a href="/tags/markdown/" style="font-size: 11.43px;">markdown</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/test/" style="font-size: 10px;">test</a> <a href="/tags/vscode/" style="font-size: 12.86px;">vscode</a> <a href="/tags/vue/" style="font-size: 14.29px;">vue</a> <a href="/tags/vue3/" style="font-size: 10px;">vue3</a> <a href="/tags/webpack/" style="font-size: 17.14px;">webpack</a> <a href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">函数式编程</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 20px;">前端</a> <a href="/tags/%E5%9B%BE%E7%89%87/" style="font-size: 10px;">图片</a> <a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 10px;">基础</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 10px;">开发</a> <a href="/tags/%E6%A1%86%E6%9E%B6/" style="font-size: 12.86px;">框架</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 11.43px;">测试</a> <a href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" style="font-size: 14.29px;">浏览器</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 12.86px;">算法</a> <a href="/tags/%E7%BB%84%E4%BB%B6/" style="font-size: 10px;">组件</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 11.43px;">网络</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" style="font-size: 11.43px;">计算机基础</a> <a href="/tags/%E8%AF%AD%E8%A8%80/" style="font-size: 14.29px;">语言</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/11/ci/ssh/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/03/11/ci/nginx/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/03/11/ci/circleci/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/03/11/%E7%AE%97%E6%B3%95/LRU%E9%A1%B5%E9%9D%A2%E7%BD%AE%E6%8D%A2%E7%AE%97%E6%B3%95/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/03/11/%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%BF%98%E8%AE%B0%E5%AF%86%E7%A0%81%E6%81%A2%E5%A4%8D/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>